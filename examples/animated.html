<html>
  <head>
    <style>
      
    body {
      margin: 0px;
    }

    </style>    
  </head>
  <body>
    <div id="elm"></div>
        
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="/d3-rs-lines.umd-es2015.min.js"></script>
    <script>

    'use strict';

    var TIMES = [
      {
        "l" : 1461456000000,
        "v" : [
          12,
          3
        ]
      },
      {
        "l" : 1461542400000,
        "v" : [
          5,
          11
        ]
      },
      {
        "l" : 1461628800000,
        "v" : [
          8,
          7
        ]
      },
      {
        "l" : 1461715200000,
        "v" : [
          18,
          5
        ]
      },
      {
        "l" : 1461801600000,
        "v" : [
          18,
          9
        ]
      },
      {
        "l" : 1461888000000,
        "v" : [
          8,
          17
        ]
      },
      {
        "l" : 1461974400000,
        "v" : [
          11,
          11
        ]
      },
      {
        "l" : 1462060800000,
        "v" : [
          8,
          2
        ]
      },
      {
        "l" : 1462147200000,
        "v" : [
          9,
          11
        ]
      },
      {
        "l" : 1462233600000,
        "v" : [
          8,
          9
        ]
      },
      {
        "l" : 1462320000000,
        "v" : [
          17,
          10
        ]
      },
      {
        "l" : 1462406400000,
        "v" : [
          19,
          14
        ]
      },
      {
        "l" : 1462492800000,
        "v" : [
          13,
          15
        ]
      },
      {
        "l" : 1462579200000,
        "v" : [
          17,
          6
        ]
      },
      {
        "l" : 1462665600000,
        "v" : [
          19,
          9
        ]
      },
      {
        "l" : 1462752000000,
        "v" : [
          9,
          1
        ]
      },
      {
        "l" : 1462838400000,
        "v" : [
          13,
          18
        ]
      },
      {
        "l" : 1462924800000,
        "v" : [
          7,
          8
        ]
      },
      {
        "l" : 1463011200000,
        "v" : [
          9,
          15
        ]
      },
      {
        "l" : 1463097600000,
        "v" : [
          10,
          2
        ]
      },
      {
        "l" : 1463184000000,
        "v" : [
          13,
          16
        ]
      },
      {
        "l" : 1463270400000,
        "v" : [
          14,
          13
        ]
      },
      {
        "l" : 1463356800000,
        "v" : [
          7,
          7
        ]
      },
      {
        "l" : 1463443200000,
        "v" : [
          7,
          6
        ]
      },
      {
        "l" : 1463529600000,
        "v" : [
          19,
          4
        ]
      },
      {
        "l" : 1463616000000,
        "v" : [
          15,
          9
        ]
      },
      {
        "l" : 1463702400000,
        "v" : [
          5,
          9
        ]
      },
      {
        "l" : 1463788800000,
        "v" : [
          17,
          12
        ]
      },
      {
        "l" : 1463875200000,
        "v" : [
          10,
          11
        ]
      },
      {
        "l" : 1463961600000,
        "v" : [
          19,
          13
        ]
      },
      {
        "l" : 1464048000000,
        "v" : [
          4,
          18
        ]
      },
      {
        "l" : 1464134400000,
        "v" : [
          12,
          2
        ]
      },
      {
        "l" : 1464220800000,
        "v" : [
          4,
          16
        ]
      },
      {
        "l" : 1464307200000,
        "v" : [
          14,
          5
        ]
      },
      {
        "l" : 1464393600000,
        "v" : [
          11,
          17
        ]
      },
      {
        "l" : 1464480000000,
        "v" : [
          3,
          12
        ]
      },
      {
        "l" : 1464566400000,
        "v" : [
          3,
          6
        ]
      },
      {
        "l" : 1464652800000,
        "v" : [
          1,
          4
        ]
      },
      {
        "l" : 1464739200000,
        "v" : [
          10,
          17
        ]
      },
      {
        "l" : 1464825600000,
        "v" : [
          2,
          10
        ]
      },
      {
        "l" : 1464912000000,
        "v" : [
          6,
          3
        ]
      },
      {
        "l" : 1464998400000,
        "v" : [
          4,
          12
        ]
      },
      {
        "l" : 1465084800000,
        "v" : [
          9,
          5
        ]
      },
      {
        "l" : 1465171200000,
        "v" : [
          16,
          4
        ]
      },
      {
        "l" : 1465257600000,
        "v" : [
          14,
          6
        ]
      },
      {
        "l" : 1465344000000,
        "v" : [
          5,
          16
        ]
      },
      {
        "l" : 1465430400000,
        "v" : [
          5,
          13
        ]
      },
      {
        "l" : 1465516800000,
        "v" : [
          18,
          13
        ]
      },
      {
        "l" : 1465603200000,
        "v" : [
          16,
          6
        ]
      },
      {
        "l" : 1465689600000,
        "v" : [
          14,
          18
        ]
      },
      {
        "l" : 1465776000000,
        "v" : [
          0,
          0
        ]
      },
      {
        "l" : 1465862400000,
        "v" : [
          0,
          0
        ]
      },
      {
        "l" : 1465948800000,
        "v" : [
          18,
          18
        ]
      },
      {
        "l" : 1466035200000,
        "v" : [
          2,
          1
        ]
      },
      {
        "l" : 1466121600000,
        "v" : [
          15,
          14
        ]
      },
      {
        "l" : 1466208000000,
        "v" : [
          11,
          5
        ]
      },
      {
        "l" : 1466294400000,
        "v" : [
          2,
          1
        ]
      },
      {
        "l" : 1466380800000,
        "v" : [
          5,
          7
        ]
      },
      {
        "l" : 1466467200000,
        "v" : [
          14,
          19
        ]
      },
      {
        "l" : 1466553600000,
        "v" : [
          11,
          9
        ]
      }
    ];
                    
    let stacks = d3_rs_lines.html('stacked')
                          .width(700) // scale it up
                          .tickCountIndex('utcMonth') // want monthly ticks
                          .labelTime('multi') // use the smart formatter
                          .legend([ 'A', 'B' ]) // add the legend
                          .language('fr')
                          .stacked(false) // boolean or array of object keys
                          .curve('curveStepBefore')
                          .tickFormatValue('($.0f');
                          
    let i = 3;                  
    let animate = d3.select('#elm')
      .datum(TIMES.slice(0, i)) 
        .call(stacks);
    
    let timer = null;    
    function doit() {  
        // keep adding data sets
        if (i < TIMES.length) {
            i++; 
        } else {
            clearInterval(timer);
            timer = null;
            return
        }
        // 2 stage animation
        // rescale the graph using the trim action to i - 1
        // then remove the data trimming and animate the new value
        animate
          .datum(TIMES.slice(0, i)) 
          .transition()
            .duration(500)
            .call(stacks.animation('default').trim(i - 1))
            .on('end', function() {
                animate.transition()
                        .duration(1000)
                        .call(stacks.animation('reveal').trim(null));
            }); 
            
    }
    timer = setInterval(doit, 2000);



    </script>
  </body>
</html>
